{% block extra_css %}
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&family=Rock+Salt&display=swap');

* {
  margin: 0; padding: 0;
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}

/************ ANIMATED GRADIENT BACKGROUND ************/
.animated-bg-gradient {
  position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
  z-index: -1; pointer-events: none;
  background: linear-gradient(120deg, #191930 0%, #1a1135 30%, #16305c 60%, #161b47 100%);
  background-size: 400% 400%;
  animation: bgPan 22s ease-in-out infinite alternate;
}
@keyframes bgPan {
  0% {background-position: 0% 25%;}
  20% {background-position: 60% 100%;}
  50% {background-position: 100% 50%;}
  75% {background-position: 30% 0%;}
  100% {background-position: 0% 25%;}
}

/************ TYPOGRAPHY ************/
h1, h2, h3, h4, h5, h6 {
  font-family: 'Montserrat', sans-serif;
  letter-spacing: 1.5px;
  font-weight: 800;
}
.page-title {
  text-align: center; margin-bottom: 33px;
  font-size: 2.5rem; color: #fff; letter-spacing: 2.5px;
  text-shadow: 0 0 24px #625dc059;
  opacity: 0; transform: scale(0.96) translateY(-24px);
  animation: fadePageTitle .85s .12s cubic-bezier(.6,2,0.3,1) forwards;
  position: relative;
}
.page-title::after {
  content: ""; display: block; margin: 20px auto 0;
  width: 120px; height: 5px; border-radius: 3px;
  background: linear-gradient(90deg, #33ffd6, #6980fa, #c471f5, #ff6cab);
  animation: fadeUnderline 1.2s .7s cubic-bezier(.5,2.1,.51,1) forwards;
  opacity: 0;
}
@keyframes fadePageTitle {
  to {opacity: 1; transform: scale(1) translateY(0);}
}
@keyframes fadeUnderline {
  from {opacity:0;width:0;}
  to {opacity:1;width:120px;}
}

body {
  background: transparent !important;
  color: #f1f1f6;
}

/************ CONTAINERS + GRID ************/
.profile-container {
  display: grid; grid-template-columns: 1fr; gap: 37px;
  max-width: 1200px; margin: 0 auto;
}

/************ GLASSY CARD EFFECT ************/
.profile-header-card, .stats-section, .attempts-section {
  background: rgba(24, 26, 54, 0.75);
  border-radius: 20px;
  box-shadow: 0 10px 38px 0 #3b3c6488, 0 3px 10px 0 #6980fa44;
  backdrop-filter: blur(16px);
  border: 1.2px solid rgba(255,255,255,0.07);
}
.profile-header-card {
  padding: 54px 50px 44px 50px; 
  position: relative; overflow: hidden;
  animation: cardPop 1.15s cubic-bezier(.22,1.32,.22,1) .11s both;
}
@keyframes cardPop {
  0% { opacity: 0; transform: translateY(36px) scale(.98);}
  100%{ opacity: 1; transform: translateY(0) scale(1);}
}
.profile-header-card::after {
  content:"";position:absolute;top:0;left:0;right:0;height:7px;
  background: linear-gradient(90deg,#6980fa 5%, #33ffd6 60%, #ff6cab 100%);
  opacity:.33;
  animation: fadeUnderline 1s 1s both;
}
.stats-section { display:grid; grid-template-columns: repeat(auto-fit,minmax(215px,1fr)); gap:26px; margin: 30px 0 3px 0; padding: 22px 0 22px 0;}
.stat-card {
  background: rgba(255,255,255,0.07); border-radius:19px;
  border:1.2px solid #6980fa66;
  padding: 30px; text-align: center;
  box-shadow: 0 3px 18px #3b3c6466;
  transform: scale(0.97) translateY(22px); opacity: 0;
  animation: statPop .9s cubic-bezier(.6,2,.24,1.13) both;
}
.stats-section .stat-card:nth-child(1){animation-delay:.18s;}
.stats-section .stat-card:nth-child(2){animation-delay:.32s;}
.stats-section .stat-card:nth-child(3){animation-delay:.44s;}
.stats-section .stat-card:nth-child(4){animation-delay:.59s;}
@keyframes statPop {
  0% {opacity:0;transform:scale(.85)translateY(44px);}
  70%{opacity:1;transform:scale(1.12)translateY(-9px);}
  100%{opacity:1;transform:scale(1)translateY(0);}
}
.stat-value {font-size:2.16rem;font-family:'Montserrat',sans-serif;color:#33ffd6;font-weight:800;}
.stat-card:hover {transform:scale(1.05) translateY(-6px);box-shadow:0 10px 30px #33ffd655;}

.stat-label {font-size:1.02rem;color:#e1e6ef;oapcity:.81;font-weight:600;letter-spacing:.8px;}

.attempts-section {
  margin-top:19px;padding: 42px 38px 38px 38px;
  animation: cardPop 1.26s 0.52s both;
}

/************ PROFILE HEADER ************/
.profile-header { display: flex; align-items:center; gap:47px;
  margin-bottom:35px; padding-bottom:29px; border-bottom:1.3px solid #252857;}
.profile-avatar {
  width: 115px; height: 115px;
  border-radius: 50%;
  background: linear-gradient(140deg,#6980fa 0%,#ff6cab 100%);
  display: flex; align-items: center; justify-content: center;
  font-size: 2.6rem;
  color: #212246; font-weight:800;
  box-shadow: 0 8px 27px #33ffd655;
  border:6px solid #1a182e;
  position:relative;
  animation: avatarEnter 1.06s 0.27s both;
}
.profile-avatar::before {
  content:"";position:absolute;inset:0;border-radius:50%;
  border: 3px solid #33ffd6; opacity:.22;
  animation: spin 2.4s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg);}}
@keyframes avatarEnter {
  from{opacity:0;transform:scale(.7)translateY(28px);}
  to{opacity:1;transform:scale(1)translateY(0);}
}

.profile-info h3 {
  font-size:1.7rem;color:#fff;margin-bottom:13px;letter-spacing:1.2px;text-shadow:0 0 8px #33ffd65c;}
.profile-info p {font-size:1.08rem;color:#E4E9FD;margin-bottom:8px;opacity:.93;}

.profile-details{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:23px;margin-top:14px;}
.detail-card {
  background: rgba(255,255,255,0.07); border-radius:13px;
  padding:22px 19px; box-shadow:0 2px 12px #3b3c6422;
  border-left:4px solid #33ffd6; opacity:0;
  animation: detailPop 0.86s cubic-bezier(.7,1.5,.27,1.19) both;
}
.profile-details .detail-card:nth-child(1){animation-delay:.33s;}
.profile-details .detail-card:nth-child(2){animation-delay:.42s;}
.profile-details .detail-card:nth-child(3){animation-delay:.56s;}

@keyframes detailPop{
  0%{opacity:0;transform:scale(.8)translateY(32px);}
  66%{opacity:1;transform:scale(1.04);}
  100%{opacity:1;transform:scale(1);}
}
.detail-card:hover {
  border-left:4px solid #ff6cab;
  box-shadow:0 5px 15px #ff6cab88;
}
.detail-card h4 {font-size:0.98rem;color:#b5cffa;text-transform:uppercase;letter-spacing:1.1px;font-weight:600;margin-bottom:8px;}
.detail-card p {font-size:1.12rem;color:#fffdfe;font-weight:600;margin:0;}

.section-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 32px;
}
.section-title {
  color: #fff;
  font-size: 2rem;
  font-weight: 800;
  letter-spacing: 1.2px;
  text-shadow:0 0 10px #33ffd6b0;
  position:relative;
}
.section-title::after {
  content:"";position:absolute;bottom:-8px;left:0;width:58px;height:4.5px;background:linear-gradient(90deg,#33ffd6,#6980fa,#ff6cab);border-radius:2.8px;
}

/************ TABLE ************/
.attempts-table th {
  background: linear-gradient(120deg,#33ffd6 5%,#6980fa,#ff6cab 98%);
  color:#1b163a;
  border-bottom:1.8px solid #161b47;
  padding:18px 12px;font-size:1.01em;text-align:left;
  letter-spacing:.8px;text-transform:uppercase;
  font-family:'Rock Salt', cursive;font-weight:400;
}

/* Enhanced table animation with more attractive effects */
.attempts-table {
  width: 100%; border-collapse: collapse; border-radius: 17px; overflow: hidden; font-size: 1.07rem;
  background: rgba(255,255,255,0.05);
  margin-bottom:8px;
  opacity:0;transform:scale(.95) translateY(16px); 
  animation: tablePop 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) 1.09s both;
}

@keyframes tablePop {
  0% {
    opacity: 0;
    transform: scale(0.8) translateY(50px) rotateX(30deg);
    filter: blur(5px);
  }
  50% {
    opacity: 0.7;
    transform: scale(1.03) translateY(-10px) rotateX(10deg);
    filter: blur(1px);
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0) rotateX(0);
    filter: blur(0);
  }
}

/* Enhanced row animations with staggered delays */
.attempts-table tbody tr {
  opacity: 0;
  transform: translateX(-30px);
  animation: rowSlideIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

.attempts-table tbody tr:nth-child(1) { animation-delay: 1.3s; }
.attempts-table tbody tr:nth-child(2) { animation-delay: 1.4s; }
.attempts-table tbody tr:nth-child(3) { animation-delay: 1.5s; }
.attempts-table tbody tr:nth-child(4) { animation-delay: 1.6s; }
.attempts-table tbody tr:nth-child(5) { animation-delay: 1.7s; }

@keyframes rowSlideIn {
  0% {
    opacity: 0;
    transform: translateX(-30px) rotateY(20deg);
    filter: blur(2px);
  }
  100% {
    opacity: 1;
    transform: translateX(0) rotateY(0);
    filter: blur(0);
  }
}

/* Enhanced hover effect for rows */
.attempts-table tr:hover {
  background: linear-gradient(90deg, #33ffd622 10%, #6980fa19 90%);
  box-shadow: 0 5px 20px #33ffd633;
  transform: scale(1.01) translateY(-2px);
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.attempts-table td {
  padding:16px 12px;font-size:1em;font-family:'Poppins',sans-serif;color:#f8f8fd;border-bottom:1.4px solid #23213b;
}
.attempts-table tr:nth-child(even) {background: rgba(144, 75, 255, 0.06);}

/************ BADGES, BUTTONS ************/
.score-display {
  font-weight: 700; padding: 8px 13px; border-radius: 7px;
  display: inline-block; font-size:1.05em;text-align:center;min-width:72px;
  background:linear-gradient(120deg,#33ffd6,#6980fa);color:#102c2e;
  box-shadow: 0 2px 8px #33ffd640;
}
.score-high   {background: linear-gradient(120deg,#cfff5f77,#30fcae77);}
.score-medium {background: linear-gradient(120deg,#ffc86b77,#f9f87177);}
.score-low    {background: linear-gradient(120deg,#ffe69777,#ff6cab66);}

.status-badge {
  display:inline-block;padding:8px 15px;border-radius:25px;font-weight:700;font-size:1em;letter-spacing:0.5px;text-transform:uppercase;transition:all .2s;box-shadow:0 2px 9px #33ffd66a;
}
.status-completed {background:linear-gradient(120deg,#0fd9d9,#4ee9a7);color:#04312c;}
.status-pending   {background:linear-gradient(120deg,#f3c10e,#f4105e 89%);color:#190501;}

.btn {
  display:inline-block;padding:10px 19px;background:linear-gradient(120deg,#392afc 0%,#ff6cab 100%);
  color:#fff;text-decoration:none;border-radius:8px;font-weight:700;font-size:1.03rem;
  border:none;cursor:pointer;transition:all .22s;;
  box-shadow:0 4px 13px #33ffd641;border:1px solid rgba(255,255,255,0.08);margin:0 3px 3px 0;
}
.btn:hover {transform: scale(1.07) translateY(-2.8px);box-shadow:0 9px 23px #392afcbf;}

.back-btn {
  display:inline-flex;align-items:center;gap:8px;padding:13px 35px;
  background:linear-gradient(120deg,#392afc 0%,#ff6cab 100%);
  color:#fff;text-decoration:none;border-radius:50px;font-weight:700;font-size:1.14rem;
  border:none;outline:none;transition:all 0.33s;backdrop-filter:blur(10px);
  border:1px solid rgba(255,255,255,0.12);margin-bottom:34px;box-shadow:0 5px 15px #33ffd641;}
.back-btn:hover{transform:scale(1.09)translateY(-5px);background:linear-gradient(120deg,#ff6cab,#392afc);}

@media (max-width:1000px){.profile-header-card{padding:30px 20px;}}
@media (max-width:680px){
  .profile-header{flex-direction:column;text-align:center;gap:13px;}
  .profile-details{grid-template-columns:1fr;}
  .stats-section{grid-template-columns:1fr 1fr;}
  .profile-container{gap:14px;}
  .profile-avatar{width:82px;height:82px;font-size:1.3rem;}
  .page-title{font-size:1.6rem;}
}
@media (max-width:520px){
  .profile-header-card, .attempts-section {padding:12vw 2vw 6vw 2vw; border-radius:12px;}
  .attempts-table th, .attempts-table td {padding:9px 5px;font-size:0.9em;}
  .stats-section{grid-template-columns:1fr;}
}

/* Remove particles and circle classes if you don't want them over the animated gradient. */

</style>
{% endblock %}

{% block content %}
<div class="animated-bg-gradient"></div>
<h2 class="page-title">Student Profile</h2>

<div class="profile-container">
  <!-- Profile Header Card -->
  <div class="profile-header-card card-highlight">
    <div class="profile-header">
      <div class="profile-avatar">
        {{ student.username|first|upper }}
      </div>
      <div class="profile-info">
        <h3>{{ student.username }}</h3>
        <p>Member since: {{ student.date_joined|date:"F d, Y" }}</p>
        <p>Roll Number: {{ student.roll_number }}</p>
      </div>
    </div>
    <div class="profile-details">
      <div class="detail-card card-highlight">
        <h4>Email</h4>
        <p>{{ student.email }}</p>
      </div>
      <div class="detail-card card-highlight">
        <h4>Phone</h4>
        <p>{{ student.phone }}</p>
      </div>
      <div class="detail-card card-highlight">
        <h4>Branch</h4>
        <p>{{ student.branch|default:"Not specified" }}</p>
      </div>
    </div>
  </div>
  <!-- Stats Section -->
  <div class="stats-section">
    <div class="stat-card card-highlight">
      <div class="stat-value">{{ quiz_attempts|length }}</div>
      <div class="stat-label">Total Attempts</div>
    </div>
    <div class="stat-card card-highlight">
      <div class="stat-value">
        {% with completed_count=quiz_attempts|length %}
          {{ completed_count }}
        {% endwith %}
      </div>
      <div class="stat-label">Completed</div>
    </div>
    <div class="stat-card card-highlight">
      <div class="stat-value">
        {% if quiz_attempts %}
          {% with first_attempt=quiz_attempts.0 %}
            {{ first_attempt.score }}/{{ first_attempt.total_marks }}
          {% endwith %}
        {% else %}
          0/0
        {% endif %}
      </div>
      <div class="stat-label">Recent Score</div>
    </div>
    <div class="stat-card card-highlight">
      <div class="stat-value">
        {% if quiz_attempts %}
          {% with first_attempt=quiz_attempts.0 %}
            {{ first_attempt.percentage|floatformat:1 }}%
          {% endwith %}
        {% else %}
          0%
        {% endif %}
      </div>
      <div class="stat-label">Recent %</div>
    </div>
  </div>
  <!-- Quiz Attempts Section -->
  <div class="attempts-section card-highlight">
    <div class="section-header">
      <h3 class="section-title">Quiz Attempts</h3>
    </div>
    {% if quiz_attempts %}
    <table class="attempts-table">
      <thead>
        <tr>
          <th style="font-size: 13px;">Quiz Title</th>
          <th style="font-size: 13px;">Started At</th>
          <th style="font-size: 13px;">Completed At</th>
          <th style="font-size: 13px;">Score</th>
          <th style="font-size: 13px;">Percentage</th>
          <th style="font-size: 13px;">Status</th>
          <th style="font-size: 13px;">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for attempt in quiz_attempts %}
        <tr>
          <td><strong>{{ attempt.quiz.title }}</strong></td>
          <td>{{ attempt.started_at|date:"M d, Y H:i" }}</td>
          <td>
            {% if attempt.completed_at %}
              {{ attempt.completed_at|date:"M d, Y H:i" }}
            {% else %}
              -
            {% endif %}
          </td>
          <td>
            <span class="score-display {% if attempt.percentage >= 75 %}score-high{% elif attempt.percentage >= 50 %}score-medium{% else %}score-low{% endif %}">
              {{ attempt.score }}/{{ attempt.total_marks }}
            </span>
          </td>
          <td>
            <span class="score-display {% if attempt.percentage >= 75 %}score-high{% elif attempt.percentage >= 50 %}score-medium{% else %}score-low{% endif %}">
              {{ attempt.percentage }}%
            </span>
          </td>
          <td>
            <span class="status-badge {% if attempt.is_completed %}status-completed{% else %}status-pending{% endif %}">
              {% if attempt.is_completed %}Completed{% else %}Pending{% endif %}
            </span>
          </td>
          <td>
            <a href="{% url 'quiz_result' attempt.id %}" class="btn">View</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <div class="empty-state">
      <div class="empty-state-icon">üìù</div>
      <p>This student has not attempted any quizzes yet.</p>
    </div>
    {% endif %}
    <div style="text-align: center; margin-top: 30px;">
      <a href="{% url 'manage_students' %}" class="back-btn">‚Üê Back to Student List</a>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Smooth animate-in for all loaded elements
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.card-highlight,.stat-card,.detail-card,.profile-avatar,.empty-state').forEach(function(el) {
    el.style.opacity = '1';
    el.style.transform = 'none';
  });
});
</script>
{% endblock %}
